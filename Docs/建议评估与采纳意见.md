# 泌乳系统（rjw-cummilk）建议评估与采纳意见

本文档基于当前代码库（`CompEquallyMilkable`、`HediffComp_EqualMilkingLactating`、`EqualMilkingSettings`、`MilkSetting`、规格文档等），对“另一份 AI 建议”逐条评估，并给出**是否建议采纳**及**本仓库的补充建议**。  
代码路径以 rjw-cummilk 为准。

---

## 一、可维护性与逻辑清晰度

### 1️⃣ 分离“水池状态”与“泌乳驱动逻辑”（LactationPoolState）

**建议内容**：将 `leftFullness` / `rightFullness` / `overflowAccumulator` / `ticksFullPool` 及双池推进（TickGrowth、TickShrink、Sync）抽成独立类 `LactationPoolState`，Comp 只负责游戏事件与 Hediff 联动。

**当前实现**：  
- 状态与逻辑均在 `CompEquallyMilkable` 内（约 163～282 行），含双池进水、溢出、回缩、SyncBaseFullness。  
- `HediffComp_EqualMilkingLactating` 负责 L 驱动与剩余天数，与“池水位”是分开的。

**评估与建议**：  
- **建议采纳，优先级中高**。  
- 好处：池逻辑可单测、可复用（例如日后“机器/设备”只调池接口）、Comp 更短更清晰。  
- 注意：需保留对基类 `fullness` 的同步（`SyncBaseFullness`）及存档键名，以兼容现有存档与可能依赖基类的代码。  
- 建议：`LactationPoolState` 只持有池数据与纯函数（TickGrowth、TickShrink、Sync），**不**持有 `Pawn`；容量/流速由调用方传入（与规格“容量=种族×乳房大小”一致）。

---

### 2️⃣ 拆分 CompTick 为职责清晰的函数

**建议内容**：将 `CompTick()` 拆成例如：  
`ApplyDrugInducedLactationEffects`、`UpdateMilkPools`、`HandleOverflow`、`TryTriggerRisks`、`UpdateHealthHediffs`。

**当前实现**：  
- `CompTick()` 约 164～284 行，包含：药物负担/增益 Hediff、Active 判断、双池进水、溢出与 filth、回缩、ticksFullPool、TryTriggerMastitis、乳房胀满 Hediff。

**评估与建议**：  
- **建议采纳，优先级高**。  
- 当前单方法过长，不利于单点调试与扩展；拆成上述几块后，与“1️⃣ 池状态抽离”配合更好。  
- 建议命名与现有注释一致，例如：  
  - `ApplyDrugInducedLactationEffects()`（药物泌乳负担/增益）  
  - `UpdateMilkPools()`（进水 + 回缩，可委托给 `LactationPoolState`）  
  - `HandleOverflow()`（overflowAccumulator + filth）  
  - `TryTriggerMastitis()`（已有）  
  - `UpdateHealthHediffs()`（EM_BreastsEngorged 等）

---

## 二、具体代码路径优化

### 3️⃣ Growth 逻辑：按容量比例分配流速，而非固定 50/50

**建议内容**：  
用 `leftShare = leftBaseCap / totalBaseCap`、`rightShare = rightBaseCap / totalBaseCap` 分配 `flowLeftPerTick` / `flowRightPerTick`，以体现乳房大小/基因对填充速率的影响。

**当前实现**：  
- `CompEquallyMilkable` 第 200～202 行：`leftBaseCap` / `rightBaseCap` 已通过 `GetLeftBreastCapacityFactor` / `GetRightBreastCapacityFactor` 计算（含 RJW 乳房大小）。  
- 第 199～202 行：流速仍为 `flowPerTick * 0.5f` 固定 50/50；仅“容量上限”用了左右比例，“进水分配”未用。

**评估与建议**：  
- **建议采纳，优先级高**。  
- 规格“水池 a/b 容量 = 种族×左/右乳大小”“单侧变满时间 = 该侧容量÷(当前泌乳量×饥饿系数)”与“按容量比例分配流速”一致；当前 50/50 在左右乳大小差异大时与规格不符。  
- 实现示例（保持总流速不变）：  
  - `if (totalBaseCap < 1e-6f) { flowLeftPerTick = flowRightPerTick = flowPerTick * 0.5f; }`
  - `else { float leftShare = leftBaseCap / totalBaseCap; flowLeftPerTick = flowPerTick * leftShare; flowRightPerTick = flowPerTick * (1f - leftShare); }`

---

### 4️⃣ 溢出与 filth：可配置类型与种族差异

**建议内容**：filth 类型可配置；可为不同 race 指定不同 filthDef；溢出时加视觉效果或心理影响（如“乳房溢漏”记忆）。

**当前实现**：  
- 第 256～268 行：固定 `Filth_Vomit`，阈值 `PoolModelConstants.OverflowFilthThreshold`，无种族区分、无记忆/视觉效果。

**评估与建议**：  
- **filth 类型可配置**：建议采纳（优先级中），便于与现有流体/污物 mod 或翻译一致；可先做全局 Def 或设置项，再考虑按种族。  
- **按种族 filthDef**：可选扩展，优先级低；实现成本较高（需 race→filth 映射）。  
- **溢出时心情/记忆/视觉**：建议采纳（优先级中），与规格“满池/溢出对心情或健康”待办一致；可新增 ThoughtDef/记忆（如 EM_MilkOverflow）并在 `HandleOverflow` 中触发，视觉可用现有 Mote/ThrowText 简单处理。

---

### 5️⃣ 回缩公式：引入身体健康度系数

**建议内容**：  
`ShrinkPerStep` 改为可受 pawn 健康或基因加权，例如  
`shrinkFactor = PoolModelConstants.ShrinkBase * pawn.health.summaryHealth.SummaryHealthPercent`，使“身体越好回缩越快”。

**当前实现**：  
- `Constants.cs`：`ShrinkPerStep = 0.009f` 固定；规格 10.1 已定“按身体健康度回缩”“身体好恢复快”。

**评估与建议**：  
- **建议采纳，优先级中**。  
- 与规格 10.1、十七 17.2 一致；注意 `SummaryHealthPercent` 在部分版本/mod 下的可用性，需做 null/fallback 处理。  
- 建议：  
  - 每步回缩系数 = `(1f - ShrinkPerStep) * Mathf.Clamp(healthPercent, 0.2f, 1f)` 或等价形式，避免重伤时完全停回缩导致逻辑异常。

---

## 三、行为与游戏交互

### 6️⃣ 泌乳者与挤奶者权限、AI 与心情细分

**建议内容**：  
- AI：自动挤奶只对“允许者”生成 job；JobDriver 过滤 allowedSucklers。  
- 心情：允许的伙伴挤奶→正面；拒绝的挤奶→强制负面；长期无人挤→身体不适负面。

**当前实现**：  
- `WorkGiver_EquallyMilk.HasJobOnThing` 已使用 `ExtensionHelper.IsAllowedSuckler(target, pawn)`，即仅对 allowedSucklers 生成挤奶 job。  
- `CompEquallyMilkable.Gathered` 已根据 `IsAllowedSuckler` 给 EM_AllowedMilking / EM_ForcedMilking。  
- 存在 `lastGatheredTick` 与“长时间未挤奶”相关逻辑（ThoughtWorker 等需在工程内确认）。

**评估与建议**：  
- **AI 与 JobDriver**：当前已基本满足“只对允许者生成 job”；若存在其他入口（如右键菜单、其他 WorkGiver），建议统一用 `IsAllowedSuckler` 过滤。  
- **心情细分**：允许/强制挤奶已实现；“长期无人挤”若已有 ThoughtWorker_LongTimeNotMilked 则保持，否则建议补全，并与 `lastGatheredTick` 联动。  
- **“拒绝的挤奶”**：当前是“非名单内的人来挤奶→强制负面”；若想区分“明确拒绝”（如弹窗拒绝）可作后续扩展，优先级低。

---

### 7️⃣ 滞后与 UI 显示

**建议内容**：  
Fullness、LeftFullness、RightFullness 在 Hediff tooltip、Pawn info panel 明显展示；Debug 菜单或 patient info 可显示详细数值。

**当前实现**：  
- `HediffComp_EqualMilkingLactating.CompTipStringExtra` 已输出总奶量%、左/右池%、剩余天数、日流速、预计产奶量；`CompLabelInBracketsExtra` 有简短奶量%。  
- `CompDebugString()` 有 remainingDays、currentLactationAmount、dailyLactationDecay。

**评估与建议**：  
- **建议采纳“增强可见性”，优先级中**。  
- 保持现有 tooltip 与 debug 字符串；可增加：  
  - 在 colonists 表增加可选列（奶量%、剩余天数），  
  - 或在 Pawn 信息/健康页增加一小块“泌乳状态”（L、双池、E、卫生风险等），  
  - DevMode 下可折叠的“泌乳调试面板”（与建议中的 ShowDebugLactationStatusPane 一致）。  
- 不必重复造轮子，在现有 CompTipStringExtra / CompDebugString 基础上扩展即可。

---

## 四、健康/风险系统

### 8️⃣ 乳腺炎/堵塞判定细化

**建议内容**：  
加入饥饿程度/食物摄取对风险的缓解；受伤部位数量与类型加重；不同种族（动物 vs humanoid）风险系数。

**当前实现**：  
- `TryTriggerMastitis`：longFull（ticksFullPool>=60000）、hygieneRisk（Dubs Bad Hygiene）、torsoInjury；mtbDays 按条件除 1.5、 hygiene、1.3 等。

**评估与建议**：  
- **建议采纳，优先级中**。  
- 饥饿/营养：可用 `PawnUtility.BodyResourceGrowthSpeed(Pawn)` 或 needs.food 作为缓解因子（营养好则 mtbDays 增大）。  
- 受伤：当前仅“是否有 torso/breast/chest 受伤”；可按部位数量或严重度加权，避免过度复杂。  
- 种族系数：可为 humanlike / animal 设不同 mtbDays 乘数，便于平衡。  
- 注意：若将“乳腺炎”改为可配置概率与系数（见下“风险可调”），此处可作为“默认公式”的实现，再由设置覆盖。

---

### 9️⃣ 自然/药物影响心情记忆增强

**建议内容**：  
利用 EM_Prolactin_Joy、EM_Prolactin_HighThought、EM_Prolactin_Withdrawal 等，在适当时机给予心情奖励/惩罚（药物泌乳愉悦、高耐受低泌乳挫败感、综合乳房状态定期影响）。

**当前实现**：  
- 规格 10.7 将“催乳素愉悦/戒断/高量记忆”列为待办；当前代码中多为 Def 引用，触发点不完整。

**评估与建议**：  
- **建议采纳，优先级中（按需求排期）**。  
- 在服药后、成瘾满足/戒断、耐受升高且 L 偏低等时机，按 Def 存在性安全调用 TryGainMemory；避免重复给同一种记忆（可加简单 cooldown 或条件）。  
- “综合乳房状态定期影响”可与现有满池/长时间未挤奶思路合并，避免过多独立系统。

---

## 五、玩法扩展与兼容层

### 10️⃣ 机器/设备兼容层

**建议内容**：  
提供对自动设备“从双池抽取”的兼容接口；挤奶机器自动从最满侧吸；机器可设不同效率 yieldOffset。

**当前实现**：  
- `Building_Milking` 存在，有 `YieldOffset()`、`SpeedOffset()`；`JobDriver_EquallyMilk` 通过 `MilkBuilding` 使用；`Gathered` 中已按 `milkingSpot != null` 使用 `YieldOffset()` 并 `PlaceMilkThing`。

**评估与建议**：  
- **建议采纳为“接口清晰化 + 行为统一”，优先级中**。  
- 当前“选侧”在 `Gathered` 内（先挤最满一侧），机器与手动共用同一套逻辑，已满足“从最满侧吸”。  
- 可做：  
  - 在 Comp 或 LactationPoolState 上提供“取当前应挤一侧 + 取该侧可挤量”的接口，供机器/其他 mod 调用；  
  - 确保所有挤奶路径（手动、机器、未来自动设备）都走同一套双池与心情逻辑，避免重复实现。

---

### 11️⃣ 遗传/基因扩展兼容（RJW-Genes）

**建议内容**：  
识别 RJW-Genes 的基因并调整 `GetMilkFlowMultiplierFromGenes()`、`GetBreastCapacityFromGenes()`，使泌乳逻辑可被基因定制。

**当前实现**：  
- 已有 `GetMilkFlowMultiplierFromConditions`（乳腺炎等对流速的惩罚）；`GetLeftBreastCapacityFactor` / `GetRightBreastCapacityFactor` 已用 RJW 乳房 Hediff（若 rjwBreastSizeEnabled）。  
- 未看到对 rjw-genes 中“泌乳效率/容量”基因的显式读取。

**评估与建议**：  
- **建议采纳，优先级视 rjw-genes 使用情况而定**。  
- 若 rjw-genes 提供基因 def 或 stat，可在 `ExtensionHelper` 或专门 helper 中实现：  
  - `GetMilkFlowMultiplierFromGenes(pawn)`：无基因时返回 1f；  
  - `GetBreastCapacityFromGenes(pawn)` 或对左右容量系数的乘数。  
- 在 `flowPerDay` 与 `leftBaseCap/rightBaseCap` 计算处乘以上述系数，与现有 Conditions 乘数并列即可。

---

### 12️⃣ 物品标签与流体体系兼容

**建议内容**：  
产物标签与现有流体生态兼容；可附加 nutrition / mood buff（伴侣食用等）。

**当前实现**：  
- `CompShowProducer`、producerKind / producer、allowedConsumers 已存在；`EqualMilkingSettings.HasRaceTag` / `HasPawnTag` 用于打标。

**评估与建议**：  
- **建议采纳为“文档化 + 小扩展”，优先级中低**。  
- 保持现有标签与 allowedConsumers；若有社区流体/饮料 mod，在文档中说明 producer 与标签用法即可。  
- “伴侣食用产主奶→正面记忆”规格已列（EM_PartnerAteMyProduct）；若尚未实现，可在食用判定处按 producer 与 consumer 关系触发，优先级中。

---

## 六、设置与参数结构

### 13️⃣ 参数结构设计（MilkBehaviorSettings / MilkFlowSettings / MilkRiskSettings）

**建议内容**：  
将零散 bool/float 收拢为 `MilkBehaviorSettings`、`MilkFlowSettings`、`MilkRiskSettings` 等结构，便于序列化、XML 覆盖与 UI 分组。

**当前实现**：  
- `MilkSettings`（每 pawn 类型）：allowMilking、allowMilkingSelf、allowBreastFeeding、allowBreastFeedingAdult、canBeFed，为扁平字段。  
- `EqualMilkingSettings`：大量静态字段，按功能分散（泌乳效率、RJW、Cumpilation、乳腺炎等）。

**评估与建议**：  
- **建议采纳，优先级中、分步做**。  
- **MilkSettings（per-pawn）**：可先分组为“行为类”（allowMilking、canBeFed、allowBreastFeeding 等）与“功能开关”类，用嵌套类或子对象表达，ExposeData 保持向后兼容（旧 key 仍可读）。  
- **EqualMilkingSettings（全局）**：可逐步抽成“泌乳流速/容量相关”“乳腺炎/风险相关”“RJW/Cumpilation 相关”等组，便于 ModSettings 与 XML patch；不必一次大改，避免存档与现有 patch 断裂。

---

### 14️⃣ 耐受/成瘾对泌乳效率的可配置影响

**建议内容**：  
增加 `allowToleranceAffectMilk`、`toleranceFlowImpactExponent`、`ignoreToleranceAfterOverdose`，使耐受对泌乳的影响可调、曲线更平滑。

**当前实现**：  
- `GetProlactinToleranceFactor` = max(1−t, 0.05)；`GetMilkAmountFactorWithTolerance` / `GetLactatingEfficiencyFactorWithTolerance` 已用该系数；无单独“耐受影响开关”或指数曲线。

**评估与建议**：  
- **建议采纳“可配置 + 曲线”，优先级中**。  
- 增加设置：  
  - `allowToleranceAffectMilk`（默认 true），关闭则 E_tol 恒为 1；  
  - `toleranceFlowImpactExponent`（默认 1，即现行线性），可选 0.5 等使高耐受时衰减更平滑；  
- `ignoreToleranceAfterOverdose` 需与成瘾/过量逻辑联动，可作后续扩展。  
- 实现时在 `GetProlactinToleranceFactor` 或调用处读设置即可，注意存档 key 与默认值。

---

### 15️⃣ 风险/负面机制可调（概率+系数）

**建议内容**：  
乳腺炎等改为概率+系数形式，如 mastitisBaseChance、overFullnessRiskMultiplier、hygieneRiskMultiplier，便于玩家与 mod 组合调参。

**当前实现**：  
- TryTriggerMastitis 使用固定 mtbDays 与除数（1.5、0.5+hygieneRisk、1.3）；无全局“允许/禁止乳腺炎”外的细粒度参数。

**评估与建议**：  
- **建议采纳，优先级中**。  
- 在设置中增加：  
  - `allowMastitis`（已有概念时可保留）  
  - `mastitisBaseChance` 或 mtbDays 基准  
  - `overFullnessRiskMultiplier`、`hygieneRiskMultiplier`（或等价 mtbDays 除数）  
- TryTriggerMastitis 内用上述设置计算 mtbDays，便于平衡与兼容不同难度/mod。

---

### 16️⃣ 默认值与游戏流程对齐（baselineMilkDurationDays 等）

**建议内容**：  
在设置中显式提供 baselineMilkDurationDays（如 3）、birthInducedMilkDurationDays（如 10），与规格 B_T、B_T_分娩 对应。

**当前实现**：  
- `PoolModelConstants.BaseValueT = 3f`、`BaseValueTBirth = 10f` 为代码常量；剩余天数由 L 与 D(L,E) 动态计算，无“天数”直接配置。

**评估与建议**：  
- **建议采纳，优先级低～中**。  
- 可在 ModSettings 中增加“说明用”或“调参用”的展示项：  
  - `baselineMilkDurationDays`（对应 B_T，用于 UI/文档）  
  - `birthInducedMilkDurationDays`（对应 B_T_分娩）  
- 若希望玩家可直接改“基准持续天数”，需在内部将“天数”映射回 B_T（或等价常数），注意与现有 L 驱动公式一致；否则仅作显示/文档用即可。

---

### 17️⃣ UI 优化与逻辑提示（分组、Tooltip、折叠）

**建议内容**：  
每个参数下有说明；重要参数 Tooltip；设置按类别折叠（Suckling Options、Milk Flow Options 等）。

**当前实现**：  
- `Widget_AdvancedSettings` 单列列表，部分项已有 Tooltip（如 RJW、DBH）；无折叠分组。

**评估与建议**：  
- **建议采纳，优先级中**。  
- 与“13️⃣ 参数结构”结合：按 MilkFlow、MilkRisk、RJW、Cumpilation 等分组折叠；  
- 关键参数（如 lactatingEfficiencyMultiplierPerStack、乳腺炎相关）加强 Tooltip 与简短说明；  
- 若 RimWorld 版本支持，可用 Listing_Standard 的 Section 或手写折叠头。

---

### 18️⃣ DevMode 运行状态面板

**建议内容**：  
在 Mod 设置或 Debug 下提供面板显示：当前 L、左/右池、有效 E、卫生风险、待溢出量等。

**评估与建议**：  
- **建议采纳，优先级中低**。  
- 可与“7️⃣”中“泌乳调试面板”合并：Prefs.DevMode 时在设置页或单独窗口显示当前选中 pawn 的池状态、L、E、hygieneRisk、overflowAccumulator 等；数据来自现有 Comp/HediffComp，只做聚合展示。

---

### 19️⃣ 可配置的机体类型差异（raceCanAlwaysLactate 等）

**建议内容**：  
raceCanAlwaysLactate、raceCannotLactate、defaultFlowMultiplierForHumanlike 等，便于与 RJW Genes / Race mod 结合。

**当前实现**：  
- 已有 femaleAnimalAdultAlwaysLactating、IsMilkable(pawn)、GetMilkProductDef 等按种族/基因的区分；无“种族白名单/黑名单”或“人类默认流速倍率”的集中配置。

**评估与建议**：  
- **建议采纳为“可选扩展”，优先级低**。  
- 若社区有按种族定制的需求，可增加列表或 Def 引用；defaultFlowMultiplierForHumanlike 可在现有 GetMilkGrowthMultiplier/GetMilkAmount 链上乘一个全局或按种族系数。  
- 实现时注意与现有 namesToProducts、genes 等数据源统一，避免重复配置。

---

### 20️⃣ 可调节的哺乳者选择 AI 规则

**建议内容**：  
aiPreferHighFullnessTargets、aiSucklingUrgencyFactor 等，控制 AI 是否优先高满度目标、吸奶紧迫度。

**当前实现**：  
- WorkGiver 只判断 ActiveAndFull 与 IsAllowedSuckler；无“优先挤谁”的显式权重。

**评估与建议**：  
- **建议采纳为“可选扩展”，优先级低**。  
- 可在 PotentialWorkThingsGlobal 或 Job 选择时，对候选按 Fullness 排序或加权，再结合 aiSucklingUrgencyFactor（如需求满足度）做优先级；不改变“仅对允许者生成 job”的语义。

---

## 七、与游戏互动风格的一致性

### 21️⃣ 设置不绕过原生 AI

**建议内容**：  
AI 决策仍尊重 Thoughts、pawn 状态、faction 优先级；设置只辅助不覆盖。

**评估与建议**：  
- **建议采纳为设计原则**。  
- 当前 allowedSucklers、WorkGiver 过滤已体现“名单内才挤奶”；后续任何“AI 优先级”设置（如 20️⃣）也应作为权重/排序，而非绕过关系、禁闭、心情等原生意愿。

---

### 22️⃣ 设置可通过 XML/Def 覆盖

**建议内容**：  
实现 ModSettings + Def 覆盖机制，使 mod 可配置且可被 patch。

**当前实现**：  
- 设置通过 ModSettings 保存；部分数值来自 Def（如 HediffDef、GeneDef）。  
- 未见统一的 Def 覆盖层（例如 ModSettings 从 Def 读默认值或 patch 覆盖）。

**评估与建议**：  
- **建议采纳为长期方向，优先级中**。  
- 可为关键默认值提供 Def 或 XML 模板，让其他 mod 通过 PatchOperation 覆盖；或提供“从 Def 加载默认”的入口，避免仅依赖代码中的默认常量。

---

### 23️⃣ 默认设定与社区/本地化一致

**建议内容**：  
为默认 setting 提供完善说明（Def/Talk 标签），便于本地化与社区文档。

**评估与建议**：  
- **建议采纳，优先级中**。  
- 与“17️⃣ UI 优化”结合：重要选项的 label/tooltip 使用可翻译的 key，并在英文/简中 lang 中写清说明；文档中列出“参数—影响—建议联动”表（如下表），便于社区维护与玩家理解。  
- **已落实**：见独立文档 [参数联动表.md](参数联动表.md)，含参数—影响—建议联动表及默认值参考。

---

## 八、参数联动表示例（建议新增/维护）

| 参数 | 影响逻辑 | 建议联动 |
|------|----------|----------|
| flowMultiplier / 效率倍率 | 泌乳流速、L 稳态 | 与 famine/needs（饥饿系数）联动 |
| toleranceFlowImpactExponent | 耐受对流速的影响强度 | 与耐受系统、E_tol 公式一致 |
| mastitisBaseChance / 系数 | 污物/风险生成 | 与 hygiene、cleaning、DBH 联动 |
| allowSexTriggeredMilk（若存在） | 性行为泌乳触发 | 与 sex worker、RJW 参与逻辑 |
| followersAlsoCanSuck / 名单 | AI 挑选范围 | 与 faction、relationships、allowedSucklers |
| baselineMilkDurationDays | 基准持续天数（B_T） | 与 L 衰减公式、剩余天数显示 |

---

## 九、默认参数建议（与规格对齐）

以下为与规格及当前常量一致的默认值示例，便于设置与文档统一：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| baselineMilkDurationDays | 3 | 药物泌乳基准持续时间（对应 B_T） |
| birthInducedMilkDurationDays | 10 | 分娩泌乳参考持续时间（B_T_分娩） |
| baseFlowMultiplier | 1.0 | 泌乳基础流速（可由能力/种族再乘） |
| machineFlowMultiplier | 1.4（或由 Building_Milking def） | 机器辅助挤奶流速倍数 |
| toleranceFlowImpactExponent | 1.0（或 0.5 更平滑） | 耐受对流速的影响曲线 |
| allowMastitis | true | 是否启用乳腺炎概率 |
| mastitisBaseChance / mtbDays | 与当前 1.5f 等价 | 乳腺炎基础概率/MTB |
| overFullnessRiskMultiplier | 1.5 | 满池过久风险系数 |
| allowFollowersCanSuck（名单非空即允许） | 与现有逻辑一致 | 跟随者/名单内可吸奶 |
| allowSexTriggeredMilk（若实现） | true | 性行为后是否触发泌乳 |

---

## 十、总结：优先采纳顺序建议

1. **高优先级（逻辑正确性与可维护性）**  
   - **2️⃣** 拆分 CompTick 为明确职责的函数  
   - **3️⃣** 按容量比例分配左右流速（非 50/50）  
   - **1️⃣** 抽离 LactationPoolState（可与 2️⃣ 一起做）

2. **中优先级（体验与可配置性）**  
   - **5️⃣** 回缩公式引入身体健康度  
   - **4️⃣** 溢出 filth 可配置 + 溢出心情/记忆  
   - **8️⃣** 乳腺炎判定细化（饥饿、种族系数）  
   - **14️⃣** 耐受影响泌乳可配置 + 曲线  
   - **15️⃣** 乳腺炎/风险概率与系数可调  
   - **13️⃣** 设置分组（MilkBehavior/MilkFlow/MilkRisk）  
   - **17️⃣** UI 分组、Tooltip、折叠  
   - **7️⃣** 表列/信息页/DevMode 泌乳状态展示  
   - **10️⃣** 机器/设备接口清晰化

3. **中低优先级（扩展与兼容）**  
   - **9️⃣** 催乳素相关心情记忆触发  
   - **11️⃣** RJW-Genes 流速/容量基因  
   - **12️⃣** 伴侣食用产物心情与流体生态文档  
   - **16️⃣** 基准天数设置/展示  
   - **18️⃣** DevMode 泌乳状态面板  
   - **22️⃣** 设置可通过 XML/Def 覆盖

4. **低优先级（按需）**  
   - **19️⃣** 种族白名单/黑名单与默认流速  
   - **20️⃣** AI 优先高满度目标等  
   - **23️⃣** 默认设定说明与社区文档

以上均以不破坏现有存档与行为为前提；涉及 ExposeData 或 key 变更时需做兼容或迁移。
