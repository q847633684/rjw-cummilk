# 乳房容量模拟计算

本文档给出**乳房容量**（左/右池容量、总容量 maxFullness）的公式与示例计算，便于调参与排查。

---

## 1. 公式（代码对应）

- **前提**：`rjwBreastSizeEnabled == true`，且小人身上有 RJW 乳房 hediff 列表 `GetBreastList()`。
- **系数**：`coeff = rjwBreastCapacityCoefficient`（默认 2）。

| 量 | 公式 | 说明 |
|----|------|------|
| 左乳容量系数 leftFactor | `Clamp(list[0].Severity × coeff, 0.01, 10)` | 左乳 hediff 的 Severity × 容量系数 |
| 右乳容量系数 rightFactor | 单乳：0；双乳：`Clamp(list[1].Severity × coeff, 0.01, 10)` | 右乳对应右池，单乳时右=0 |
| 总容量 maxFullness | `Max(0.01, leftFactor + rightFactor)` | 左池+右池总上限 |

- **泌乳期临时增大**：若开启「泌乳期增大 RJW 乳房」，泌乳时会对 RJW 乳房 hediff 的 `Severity` 临时 +0.15（上限 1），因此**同一小人泌乳期内的 Severity 更大，算出的容量也更大**；结束泌乳后恢复原 Severity，容量随之恢复。

---

## 2. 示例计算

设 `coeff = 2`（默认）。

### 双乳，Severity 左=0.5、右=0.5（未泌乳）

- leftFactor = Clamp(0.5×2, 0.01, 10) = **1.0**
- rightFactor = Clamp(0.5×2, 0.01, 10) = **1.0**
- maxFullness = 1.0 + 1.0 = **2.0**

### 双乳，泌乳期临时 +0.15 后 左=0.65、右=0.65

- leftFactor = Clamp(0.65×2, 0.01, 10) = **1.3**
- rightFactor = Clamp(0.65×2, 0.01, 10) = **1.3**
- maxFullness = 1.3 + 1.3 = **2.6**

### 双乳，容量系数 0.8，Severity 左=0.5、右=0.5

- leftFactor = Clamp(0.5×0.8, 0.01, 10) = **0.4**
- rightFactor = Clamp(0.5×0.8, 0.01, 10) = **0.4**
- maxFullness = 0.4 + 0.4 = **0.8**

### 单乳，Severity=0.6，coeff=2

- leftFactor = Clamp(0.6×2, 0.01, 10) = **1.2**
- rightFactor = **0**
- maxFullness = **1.2**

---

## 3. 与其它逻辑的关系

- **池水位**：左池/右池当前水量上限分别为 leftFactor、rightFactor；总满度 = (leftFullness + rightFullness) / maxFullness。
- **灌满时间（估算）**：总流速/天 = 左池流速 + 右池流速（由 **defaultFlowMultiplierForHumanlike** 流速倍率参与，默认 2）。**单次剂量、Severity 0.5、容量系数 2、baseline=5** 时，总容量 2，约 **1 游戏日** 可灌满基础容量；**多剂**（L 更高、流速大）则更快，**更大乳房**（容量大、要填更多）则更慢。
- **挤奶工作量**：与 `MilkAmount` 和池满度有关，不直接读 leftFactor/rightFactor；见 `JobDriver_EquallyMilk.GetWorkTotal()`。
- **流速**：由 RJW 的 `fluidMultiplier`、**defaultFlowMultiplierForHumanlike**（流速倍率）、耐受等共同决定，与容量系数独立。

代码位置：`ExtensionHelper.GetBreastCapacityFactors`、`CompEquallyMilkable.CompTick`（maxFullness 同步）。
