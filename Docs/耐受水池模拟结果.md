# 耐受+水池模拟结果：第1~3天每天吃 1~5 次药

基于**当前代码**与 Defs 的数值模拟（Prolactin 每次耐受 +0.044，每日自然 -0.015；水池 L 每次进水 1×E_tol，日衰减 D = 1/(3×E_tol) + 0.01×L）。

## 公式与顺序

- **每次吃药**：耐受 t += 0.044，水池 L += 1 × E_tol(t)，E_tol = max(1−t, 0.05)
- **每天**：先做日衰减（t -= 0.015，L -= D），再按当天次数依次吃药

## 部分组合（第1天末 / 第2天末 / 第3天末 的 耐受 t，水池 L）

| 第1天 | 第2天 | 第3天 | 第1天末 (t, L) | 第2天末 (t, L) | 第3天末 (t, L) |
|-------|-------|-------|----------------|----------------|----------------|
| 1次   | 1次   | 1次   | (0.044, 0.956) | (0.073, 1.530) | (0.102, 2.059) |
| 1次   | 1次   | 5次   | (0.044, 0.956) | (0.073, 1.530) | (0.278, 5.211) |
| 1次   | 5次   | 1次   | (0.044, 0.956) | (0.249, 4.798) | (0.278, 5.037) |
| 3次   | 3次   | 3次   | (0.132, 2.736) | (0.249, 4.716) | (0.366, 6.268) |
| 5次   | 1次   | 1次   | (0.220, 4.340) | (0.249, 4.628) | (0.278, 4.869) |
| 5次   | 5次   | 5次   | (0.220, 4.340) | (0.425, 7.192) | (0.630, 8.845) |

## 第3天末 完整矩阵

**耐受 t**（行=第1天次数，列=第2天次数，格内为第3天吃 1~5 次的 t）

| 第1天\第2天 | 第2天1次 | 第2天2次 | 第2天3次 | 第2天4次 | 第2天5次 |
|-------------|----------|----------|----------|----------|----------|
| **第1天1次** | 0.10~0.28 | 0.15~0.32 | 0.19~0.37 | 0.23~0.41 | 0.28~0.45 |
| **第1天2次** | 0.15~0.32 | 0.19~0.37 | 0.23~0.41 | 0.28~0.45 | 0.32~0.50 |
| **第1天3次** | 0.19~0.37 | 0.23~0.41 | 0.28~0.45 | 0.32~0.50 | 0.37~0.54 |
| **第1天4次** | 0.23~0.41 | 0.28~0.45 | 0.32~0.50 | 0.37~0.54 | 0.41~0.59 |
| **第1天5次** | 0.28~0.45 | 0.32~0.50 | 0.37~0.54 | 0.41~0.59 | 0.45~0.63 |

（每格“a~b”表示第3天吃 1 次时 t=a，第3天吃 5 次时 t=b。）

**水池 L**（同上结构）

| 第1天\第2天 | 第2天1次 | 第2天2次 | 第2天3次 | 第2天4次 | 第2天5次 |
|-------------|----------|----------|----------|----------|----------|
| **第1天1次** | 2.06~5.21 | 2.87~5.85 | 3.64~6.44 | 4.36~6.99 | 5.04~7.49 |
| **第1天2次** | 2.83~5.81 | 3.60~6.40 | 4.32~6.95 | 5.00~7.44 | 5.63~7.90 |
| **第1天3次** | 3.56~6.36 | 4.28~6.90 | 4.96~7.40 | 5.59~7.86 | 6.17~8.26 |
| **第1天4次** | 4.24~6.86 | 4.91~7.36 | 5.54~7.81 | 6.13~8.22 | 6.66~8.58 |
| **第1天5次** | 4.87~7.32 | 5.50~7.77 | 6.08~8.18 | 6.62~8.54 | 7.10~8.85 |

## 小结

- **每天 1 次 × 3 天**：第3天末 t≈0.10，L≈2.06；药效几乎满（E_tol≈0.9），水池约 2 天多“满池”等效。
- **每天 5 次 × 3 天**：第3天末 t≈0.63，L≈8.85；耐受已高，单次进水约 0.37，但累计 L 仍很高。
- 耐受上限 1.0，每日只恢复 0.015，连续多日多针会快速逼近高耐受；L 无硬上限，会随 D 增大而衰减加快。

模拟脚本：`Docs/tolerance_pool_simulate.py`（可改参数重跑）。

---

## 只打一针 模拟结果（当前公式：ΔL = Δs×C_dose，Δs = raw×E_tol）

| 药物 | 一针后初始 L | 耐受 t | 泌乳持续约 |
|------|----------------|--------|------------|
| **Prolactin (0.5)** | 0.5 | 0.044 | **约 2 天**（第 2 天末 L→0） |
| **Lucilactin (2.0)** | 2.0 | 0.176 | **约 6 天**（第 6 天末 L→0） |

- **Prolactin 一针**：L 从未达到 1，即**达不到「满池」一池的等效**（L=1 约等于一池满），只能维持约 2 天泌乳。
- **Lucilactin 一针**：初始 L=2（相当于约 2 池满等效），**一开始就超过「满」**，约 6 天内逐渐衰减到 0。

若要「打一针后能灌满」：需要单针进水后 L ≥ 1，即至少 Prolactin 两针（或一针 Lucilactin）的量级。

---

## 是否合理？

### 1. 数值与模拟逻辑：**合理**

- 公式、常量与当前代码及 XML 一致，递推与日衰减计算正确。
- 耐受 t 有上限 1.0、每日恢复 0.015，水池 L 无硬顶、靠 D(L,t) 自然拉回，行为自洽。

### 2. 与《耐受系统重构设计》的差异：**当前实现不完全合理**

设计文档 4.2 要求：

- 进水应使用**本次实际 Lactating 严重度增量 Δs**：  
  \(\Delta L = \Delta s \times C_\text{dose} \times E_\text{tol}(t_\text{before})\)
- \(E_\text{tol}\) 用**吃药前**的 t，避免“先加耐受再减药效”的重复削弱。

当前代码（`AddFromDrug`）是：

- `L += 1 × E_tol(当前 t)`，**完全未使用 `rawSeverity`**；
- 调用时 Pawn 已带上本次 +0.044 的耐受，因此用的是**吃药后**的 t。

因此：

- **Prolactin（0.5 严重度）和 Lucilactin（2.0 严重度）对 L 的贡献被算成一样**，与“按剂量换算进水”的设计不符。
- 用“吃药后”的 t 算 E_tol，同一针的药效会被多削一次，偏保守。

若按设计落地：应用 Δs、用 t_before，则同一用药方案下 L 会略高、且 Prolactin / Lucilactin 会拉开差距，更符合设计意图。

### 3. 游戏平衡与体验：**大致合理**

- **轻度用药**（如每天 1 次 × 3 天）：t≈0.10、L≈2，E_tol≈0.9，可持续约 2 天多等效满池，负担小、收益清晰，合理。
- **重度用药**（如每天 5 次 × 3 天）：t≈0.63，E_tol≈0.37，单次药效明显变弱；L≈8.85 时日衰减 D 约 ≈1，剩余等效天数约 L/D≈8～9 天。连续 15 针换约一周多高泌乳，耐受惩罚明显，可接受。
- L 无硬上限、仅靠 D 拉回，与设计中的“水池 + 负反馈”一致，无需改。

**结论**：  
- **从“模拟是否算对、数字是否自洽”看：合理。**  
- **从“是否完全符合《耐受系统重构设计》”看：当前实现有两处偏差（未用 Δs、用 t_after），应在重构时按 4.2 改为“按 Δs + t_before”的进水公式。**
