# 灌满双乳能量消耗模拟计算

本文档按当前代码公式，说明「从空池到满池」所对应的**营养（能量）消耗**。  
**设计**：灌满期间额外消耗与灌满量 **1:1**——灌满 1 池单位即消耗 1 营养；满池后不再额外消耗。

---

## 原逻辑 vs 现逻辑（差异概要）

| 项目 | 原逻辑 | 现逻辑 |
|------|--------|--------|
| **额外营养/天** | `hungerRateFactorOffset × BodyResourceGrowthSpeed × BaseNutritionPerDay`<br>（offset = mult^severity，与产奶量无关） | `GetFlowPerDay()` = 实际进水流速 flowPerDay<br>（与产奶量 1:1） |
| **施加方式** | 通过 Lactating 的 stage：`hungerRateFactorOffset` 让游戏自动加快饥饿条下降 | stage 的 offset 改为 0；用 **Need.NeedInterval** 补丁每 150 tick 对饱食度减去 `flowPerDay×(150/60000)` |
| **灌满 1 池时的额外消耗** | 约 0.6 营养（约 2 天 × 0.3 营养/天）<br>**与产奶量不平衡** | **1 营养**（= 灌满量）<br>**与产奶量 1:1** |
| **满池后** | offset=0（isFull 时 stage 无额外饥饿） | GetFlowPerDay()=0，补丁不扣；效果一致 |
| **机械体** | ExtraEnergyPerDay = offset × BaseFallPerDay（与产奶量无关） | ExtraEnergyPerDay = flowPerDay × nutritionToEnergyFactor（与产奶量 1:1）；实际扣能量需另补丁 |

**总结**：原逻辑用「按严重度固定比例加饥饿」，与真实产奶流速脱节；现逻辑改为「按产奶流速 flowPerDay 直接扣饱食度」，使灌满多少就多消耗多少营养。

---

## 一、平衡关系

- **ExtraNutritionPerDay** = 当前产奶流速 **flowPerDay**（池单位/天），与进水公式一致；满池时为 0。
- 通过 **Need_Food** 的 NeedInterval 补丁，每 150 tick 对饱食度施加 **flowPerDay × (150/60000)** 的额外下降。
- 因此：**灌满时间 T = maxFullness / flowPerDay**，**灌满期间额外营养 = flowPerDay × T = maxFullness**。  
  → 灌满 1 即消耗 1 营养，灌满 0.5 即消耗 0.5 营养。

---

## 二、前提与符号

- **灌满**：双池总满度从 0 到 `maxFullness`（总容量）。
- **总容量**：正常人双乳 = 1；单乳 = 0.5；乳房更大时 = (左Severity+右Severity)/2。
- **流速**：`flowPerDay = L × 饥饿系数 × Conditions × Genes × 人形倍率`，其中 `饥饿系数 = BodyResourceGrowthSpeed(Pawn)`，饱腹时 = 1。
- 人形：额外消耗由 **Need_Food** 补丁按 flowPerDay 施加；机械体：**ExtraEnergyPerDay** = flowPerDay × nutritionToEnergyFactor（若需同逻辑可对 Need_MechEnergy 做补丁）。

---

## 三、场景：正常人、吃一次药、饱腹

- **L** = 0.5（一次药，无耐受，人形倍率 1）
- **maxFullness** = 1（双乳正常）
- **flowPerDay** = 0.5 × 1 = **0.5**（池单位/天）
- **灌满时间** = maxFullness / flowPerDay = **2 游戏日**
- **灌满期间额外营养** = flowPerDay × 2 = **1 营养**（与灌满量 1 持平）

| 项目           | 数值        |
|----------------|-------------|
| 灌满时间       | 2 游戏日    |
| 灌满期间额外营养 | **1 营养**（= 灌满量） |
| 池内奶量（等价） | 1 营养（吸奶 1:1 饱食度） |

---

## 四、其他容量

| 容量类型   | maxFullness | 灌满时间（L=0.5） | 灌满期间额外营养 |
|------------|-------------|-------------------|------------------|
| 双乳正常   | 1           | 2 天              | 1 营养           |
| 单乳       | 0.5         | 1 天              | 0.5 营养         |
| 双乳加大×2 | 2           | 4 天              | 2 营养           |

---

## 五、说明

- 满池后 GetFlowPerDay() 返回 0，不再施加额外饥饿。
- 半饿时 BodyResourceGrowthSpeed<1，flowPerDay 与灌满时间会变，额外营养仍等于灌满量。
- 机械体：ExtraEnergyPerDay = flowPerDay × nutritionToEnergyFactor；若需实际扣除能量，可对机械体 Need 做与 Need_Food 类似的补丁。
