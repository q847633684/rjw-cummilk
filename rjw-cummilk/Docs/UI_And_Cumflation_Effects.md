# 原版 UI 与当前 UI 区别 / 精液膨胀与泄精效果说明

## 0. 游戏内操控 UI 入口（点击小人 vs 主菜单）

以下都是**进入游戏后**操控小人/建筑时的界面位置，不是 Mod 设置界面。

### 指挥小人吸乳 / 哺乳

- **入口**：**点击小人** → **右键点击目标**。
- **操作**：
  1. 先**选中**要执行操作的小人（谁去吸奶 / 谁去喂奶）。
  2. **右键点击**地图上的**目标**（婴儿、或产奶的殖民者/动物等）。
  3. 在弹出的**浮动菜单（右键菜单）**里**只会出现当前可执行的选项**：
     - **「哺乳 [目标名]」**：仅当选中小人可以给目标喂奶时显示（让选中的小人去喂目标，例如给婴儿喂奶）；
     - **「吸 [目标名] 的奶」**（或类似表述）：仅当选中小人可以吸目标的奶时显示。
- 不可执行时（距离、权限、产奶者“谁可以使用我的奶”名单等不满足）**不会**出现灰色选项，该条不会出现在菜单中。
- **代码位置**：`FloatMenuMakerMap.AddHumanlikeOrders` 的 Postfix 会替换/添加 `BreastfeedMenuOptions`；1.6 还有 `FloatMenuOptionProvider_Breastfeed` 提供同一套选项。

### “指定”弹窗（谁可以使用我的奶 / 谁可以吃我的奶制品或精液制品）

- **入口**：**下面主菜单（底部栏）** → **「平等产奶」按钮** → 打开**奶表格** → 某行 **「指定」** 列点 **「…」**。
- **弹窗内容**：只保留**名单**；**谁可以使用我的奶**名单同时用于**吸奶**（婴儿/成人直接吸）和**挤奶**（他人用挤奶点/泵挤我）。**下方名单默认已勾选子女与伴侣**（名单为空时会自动预填），可添加或移除。

  **女角色（泌乳者）** 点「…」后可见：
  | 项目 | 说明 |
  |------|------|
  | **谁可以使用我的奶** | 标题 + 下方名单。名单**默认已勾选子女 + 伴侣**（空时自动预填）；仅名单内的人可吸奶、可挤奶。可添加或移除。 |
  | **谁可以吃我的奶制品** | 标题 + 下方名单；默认仅自己，可添加其他人允许吃 Ta 的奶或奶制食物。 |

  **男角色**（Cumpilation 下）点「…」后可见：
  | 项目 | 说明 |
  |------|------|
  | **谁可以吃我的精液制品** | 标题 + 下方名单；默认仅自己，可添加其他人允许吃 Ta 的精液或精液制品。 |

### 是否允许精液泄漏 / 是否塞住（泄精控制）

- **入口**：**奶表格** — 主菜单「平等产奶」→ 奶表格中的 **「塞住」**、**「允许泄精」** 两列（仅人形成人、有阴道、可被膨胀且玩家控制时显示勾选）。
- **说明**：
  - **塞住**：勾选后**自然泄漏**会被阻止（HediffComp_LeakCum 会检查 IsSealed）。
  - **允许泄精**：勾选 = 小人会**自动或手动去做泄精 Job**（泄到桶、清洁、随地）；不勾 = 小人**不会**去做泄精 Job（JobGiver_Deflate 会检查 CanDeflate()）。
- 只有**玩家控制**的成人、且有阴道、可被膨胀时该行才会显示这两列的勾选；动物不显示。**选中小人时 Gizmo 栏不再提供塞住/泄精按钮**，仅通过奶表格操作。

### 精液桶关联床

- **入口**：**点击精液桶**（选中该建筑）→ **下方 Gizmo 栏**。
- **显示**：选中地图上的**精液桶**后，Gizmo 区会出现 **「关联床」**、**「解除关联」** 等按钮；点击「关联床」会弹出选择床的窗口（同房间 / 其他房间）。

### 小结

| 功能 | 入口 | 具体位置 |
|------|------|----------|
| 指挥小人吸乳/哺乳 | 点击小人 | 选中小人 → 右键点击目标 → 浮动菜单里选「哺乳」或「吸奶」 |
| 谁可以使用我的奶/谁可以吃奶或精液制品 | 主菜单 | 底部栏「平等产奶」→ 奶表格 → 某行「指定」列点「…」 |
| 是否塞住、允许泄精 | 主菜单 | 底部栏「平等产奶」→ 奶表格中「塞住」「允许泄精」列 |
| 精液桶关联床 | 点击建筑 | 选中精液桶 → 下方 Gizmo 栏「关联床」/「解除关联」 |

**“是否允许精液泄漏”等全局开关**（如自动泄到桶、自动泄到清洁、自动随地、污物、隐私、倍率等）在 **Mod 设置** 里：**选项 → Equal Milking → 第 6 个 Tab「Cumpilation - Base Settings」** 下半部分的泄精设置，**不在**小人或建筑的 Gizmo 里。

### 奶表格列说明（允许自己挤奶 / 指定 / 塞住 / 泄精）

在**主菜单 → 平等产奶 → 奶表格**里，每行代表一个产奶者（殖民者/动物等），主要列含义如下：

| 列名 | 含义 | 作用 |
|------|------|------|
| **允许自己挤奶** | 是否允许**我自己**去挤自己的奶 | 开启：该产奶者会**自己**去找挤奶点/泵，给自己挤奶（自动 Job）。关闭：Ta 不会自动去挤自己的奶。 |
| **指定** | 谁可以使用我的奶（名单）、谁可以吃奶/精液制品（名单） | 点「…」打开弹窗：**女** = **谁可以使用我的奶**（名单默认勾选子女+伴侣，可添加或移除）、谁可以吃我的奶制品（名单）；**男** = 谁可以吃我的精液制品（名单）。吸奶与挤奶均只按“谁可以使用我的奶”名单判断。 |
| **塞住** | 是否塞住（防自然泄漏） | 有阴道时显示勾选。勾选 = 塞住，精液不自然泄漏。 |
| **允许泄精** | 是否允许去做泄精 Job | 可被膨胀时显示勾选。勾选 = 会去做泄到桶/清洁/随地；不勾 = 不会自动泄精。 |

- **谁可以使用我的奶**名单：同时控制**吸奶**（婴儿/成人直接吸）和**挤奶**（他人用挤奶点/泵挤我）；**下方名单默认已勾选子女与伴侣**（空时自动预填），可添加或移除。  
- **自己挤奶** = 该小人自己去挤奶点/泵挤自己的奶，仍在表格「允许自己挤奶」列勾选。

### 奶表格列：女角色 vs 男角色

下表表示**主菜单 → 平等产奶 → 奶表格**中，同一张表对**女角色**和**男角色**分别会看到/可操作哪些列。所有人都有「标签、性别、生命阶段、怀孕、指定、泌乳(Dev)」等列；差异在于泌乳相关与泄精相关列是否出现、以及「指定」弹窗内的选项不同。

| 列名 | 女角色（殖民者/奴隶） | 男角色（殖民者/奴隶） |
|------|------------------------|------------------------|
| 标签 / 姓名 | ✓ 显示 | ✓ 显示 |
| 性别 | ✓ 显示 | ✓ 显示 |
| 生命阶段 | ✓ 显示 | ✓ 显示 |
| 怀孕 | ✓ 显示 | ✓ 显示（或 -） |
| 奶类型 | ✓ 奶等 | ✓ 精液等（或 -） |
| 泌乳 | ✓ 泌乳状态 | - 一般不显示 |
| 奶量 | ✓ 泌乳时有奶量 | - |
| 允许自己挤奶 | ✓ 泌乳时可勾选 | - |
| **指定**（点「…」） | ✓ **谁可以使用我的奶**（名单默认勾选子女+伴侣）、**谁可以吃我的奶制品**（名单） | ✓ **谁可以吃我的精液制品**（名单） |
| 塞住 | ✓ 有阴道时显示 | -（无阴道则不显示） |
| 允许泄精 | ✓ 可被膨胀时显示 | -（不可被膨胀则不显示） |
| 泌乳(Dev) | ✓ 开发模式+上帝模式时显示（+/- 调试泌乳） | ✓ 同上 |

- **塞住**、**允许泄精**两列仅对**玩家控制**的小人（殖民者/奴隶）显示勾选；动物、囚犯等不显示。
- **泌乳(Dev)**：仅开启**开发模式**且**上帝模式**时可见，用于用 +/- 按钮快速添加/移除泌乳状态，方便测试。
- **女角色**：表格中可设置泌乳相关（奶类型、泌乳、奶量、**允许自己挤奶**）、**指定**（谁可以使用我的奶名单—默认勾选子女+伴侣、谁可以吃我的奶制品名单）、以及有阴道时「塞住」「允许泄精」。吸奶与挤奶均只按“谁可以使用我的奶”名单判断。
- **男角色**：表格中主要使用「指定」设置**谁可以吃我的精液制品**；无泌乳列、无塞住/允许泄精（除非该角色在 RJW 中可被膨胀且有阴道等，则与女角色相同规则）。

---

## 1. 原版 UI 与当前 UI 的区别（Mod 设置界面）

### 原版（合并前）

- **Cumpilation** 和 **Leaking（泄精）** 各有一个独立的 Mod 设置入口：
  - 在游戏「选项 → Mod 设置」里会出现 **两个** 单独的 Cumpilation 相关项。
  - 分别由 `Cumpilation_SettingsController` 和 `Leaking_SettingsController` 提供 Mod 类入口并绘制各自的设置窗口。

### 当前（合并后）

- **单一入口**：只有「**选项 → Equal Milking**」一个 Mod 设置窗口。
- **一个 Tab 包含两套内容**：
  - 在 Equal Milking 设置窗口里新增第 6 个 Tab（文案为 `cumpilation_settings_menuname` 的翻译，如「Cumpilation - Base Settings」）。
  - 该 Tab 内由上到下依次为：
    1. **Cumpilation 主设置**：膨胀开关与倍率、填充、覆盖、清洁收集、收集距离、消费心情、振荡、调试日志等。
    2. **泄精设置**：污物生成、自动泄精到桶/清洁/随地、隐私、最小严重度、最大距离、泄精/泄出量与速度倍率等。
- **数据与兼容**：所有选项仍通过 `EqualMilkingSettings` 的 `ExposeData` 统一读写；`Cumpilation.Settings` 与 `Cumpilation.Leaking.Settings` 仅做代理，原有 Cumpilation 代码无需改调用。

**总结**：原版 = 两个独立设置项；现在 = 一个 Equal Milking 窗口里的一个 Tab 包含「膨胀/填充/覆盖 + 泄精」全部选项。

---

## 2. 精液膨胀（Cumflation）与泄精（Deflate/Leak）的效果与加成

### 2.1 精液膨胀（Cumflation）

- **开关**：`Cumpilation_EnableCumflation`（默认开）。
- **效果**：
  - 在 RJW 性行为（阴道 / 双人插入等）中，射精方会对接收方施加 **Cumflation**：给接收方添加/增加 Hediff `Cumpilation_Cumflation` 的 **Severity**。
  - **Severity 计算公式**：  
    `resultingSeverity = fluidAmount / FluidAmountRequiredToCumflatePawn(pawn, fluid)`  
    其中 `FluidAmountRequiredToCumflatePawn = 100 * BodySize * GlobalCumflationModifier`。
- **全局倍率 `Cumpilation_GlobalCumflationModifier`（0.1～5.0）**：
  - **越大**：达到同样 Severity 需要的精液量越多 → 膨胀得越慢（更“难”胀满）。
  - **越小**：同样精液量会得到更高 Severity → 膨胀得更快。
- **心情**：
  - 当 Cumflation 的 Severity **≥ 0.6** 时，会给予心情记忆：
    - 若小人喜欢膨胀（特质）：`Cumpilation_GotOverCumflatedEnjoyed`；
    - 否则：`Cumpilation_GotOverCumflated`。
- **溢出**：当 Severity **> 1.01** 时，会排队执行 `Cumpilation_OverflowingCumflation` Job，向外喷出直到 Severity 降到 1.0 以下。

### 2.2 填充（Stuffing）与覆盖（Bukkake）

- **Stuffing**：`Cumpilation_EnableStuffing` + `Cumpilation_GlobalStuffingModifier`，控制体内“填充”的多少与倍率。
- **Bukkake**：`Cumpilation_EnableBukkake` + `Cumpilation_GlobalBukkakeModifier`，控制体表“覆盖”的多少与倍率。

### 2.3 泄精（Deflate / Leak）

- **泄精** = 小人通过 Job（泄到桶、清洁、随地）或 Hediff 组件自然泄漏，减少体内的 Cumflation Severity，并可能生成精液物品或污物。
- **主要设置与含义**：

| 设置 | 含义 | 默认/范围 |
|------|------|-----------|
| **LeakMult** | 泄出**量**的倍率（自然泄漏、随地泄精等） | 0.1～10 |
| **LeakRate** | 泄出**速度**的倍率 | 0.1～10 |
| **DeflateMult** | 主动泄精（如泄到桶、提取手术）的**量**倍率 | 0.1～10 |
| **DeflateRate** | 主动泄精的**速度**倍率（如桶/清洁建筑的 deflateRate） | 0.1～10 |
| **AutoDeflateMinSeverity** | 自动泄精 Job 触发的最低 Cumflation Severity 阈值 | 0～3 |
| **AutoDeflateMaxDistance** | 寻找桶/清洁点的最大距离 | 0～1000 |
| **EnableFilthGeneration** | 泄精是否生成污物 | 开/关 |
| **EnableAutoDeflateBucket/Clean/Dirty** | 是否允许自动泄到桶/清洁/随地 | 开/关 |
| **EnablePrivacy** | 是否考虑隐私（只选“看不见”的泄精点） | 开/关 |

- **公式要点**（代码中的用法）：
  - 泄出量：与 `FluidAmountRequiredToCumflatePawn(...) * 系数 * Settings.LeakMult` 或 `* Settings.DeflateMult` 相关。
  - 泄精到桶/清洁：会减少 Cumflation Severity，并可能生成精液物品（带产主时与奶制品共用“谁可以吃”规则）。

**总结**：膨胀 = 性行为增加体内 Severity，受 GlobalCumflationModifier 调控；泄精 = 通过 Job/泄漏减少 Severity，受 LeakMult/LeakRate/DeflateMult/DeflateRate 等调控；Severity≥0.6 给心情，>1.01 触发溢出喷出。


