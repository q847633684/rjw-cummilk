# EM_Prolactin 数值一览（Lact-X 格式）

**当前实现（一条线）**：产奶速度、产奶量、饥饿**同一公式、同一倍率** = **multiplier^severity**（设置里 `lactatingEfficiencyMultiplierPerStack`，默认 1.25），**有效倍率** = **1 + (原倍率 − 1) × (1 − 耐受)**（耐受参与加成）。**每日削减** = **-0.1 × (1 + 耐受)**（未成瘾或戒断时），成瘾且满足需求时 0。

---

## 成瘾率
- 4% × (1 + 当前耐受)；耐受 ≥ 0.03 才可能成瘾

---

## 泌乳（严重度）
- 每次用药：+0.5（受耐受削减），可叠加，**无上限**；整剂(≥1)时取整显示「永久 xN」
- **产奶**：产奶速度、产奶量、饥饿**统一** = **1.25^severity**（或设置里的倍率），饥饿至少按 0.5 档算；severity>20 时效果用最后一档；**仅可哺乳、不可挤奶的人形**（breastfeed only）不显示「永久」档、severity 显示上限 0.9999
- **每日削减**：**-0.1 × (1 + 耐受)**；成瘾且满足需求时 0
- **持续时间**：severity 掉到 0 所需天数 = severity ÷ (0.1×(1+耐受))，例：severity=0.5、耐受=0.044 → 约 4.8 天

---

## 成瘾后
- 严重度可叠加（与未成瘾同一套公式），**无上限**；成瘾且满足需求时 severity 不衰减
- **维持基础产奶**（不断奶，产奶量至少保持基础）

---

## 心情
- **用药时**：娱乐需求 Joy +0.3（Prolactin）/ +1.2（Lucilactin），受耐受削减

---

## 副作用
- **饥饿**：与产奶速度、产奶量**同一倍率**（1.25^max(severity,0.5)），泌乳多消耗 = 基础饭量 × (该倍率 − 1)；**已实现耐受参与**：有效倍率 = 1 + (原倍率−1)×(1−耐受)，产奶量/产奶速度/饥饿均受耐受削减
- **营养平衡**：默认设置下可能出现「产奶提供的营养 &gt; 泌乳多消耗的营养」（略溢出）；若要平衡可调高饥饿倍率或调低产奶效率
- 其他（如有）：

---

## 耐受性
- 每次用药：+0.044（按体型）；每日衰退：-0.015
- 影响：**每日削减** = -0.1×(1+耐受)；**加成**（产奶量/产奶速度/饥饿）有效倍率 = 1+(原倍率−1)×(1−耐受)，耐受越高效果越弱；当次药效仍由 toleranceChemical 联动
- 阶段：轻度 (0–0.3)、中度 (0.3–0.6) 肾脏风险、高度 (0.6–1.0) 肾脏损伤等

---

## 戒断（成瘾且断药）
- **心情**：由需求 Chemical_EM_Prolactin 未满足驱动（游戏原生成瘾需求）
- **其他**：疼痛 ×2.0、休息恢复 +0.3、饥饿速率 +0.5、意识 -0.15、进食 -0.20
- **泌乳变化**：severity 按 **-0.1×(1+耐受)**/天 衰减，与未成瘾时相同

---

## 过量（短时多次用药）
- **触发条件**：游戏原生化学过量判定；overdoseSeverityOffset 单次 0.18～0.35，largeOverdoseChance 0.01
- **后果**：按过量严重度叠加，可能触发 ChemicalDamage 等（见游戏化学系统）

---

*以下为当前 Def / 代码实际数值与说明。*

---

## 当前实现小结

- **产奶速度、产奶量、饥饿**：代码里**统一**用 **lactatingEfficiencyMultiplierPerStack^severity**（默认 1.25），三项加成%一致。
- **每日削减**：已实现 **-0.1 × (1 + 耐受)**（未成瘾或戒断时）；成瘾且满足需求时 0。
- **成瘾后**：严重度可叠加、无上限；成瘾且满足需求时不衰减；戒断时按上式削减。

**`1.25^severity`、`1.25^max(severity,0.5)` 是什么意思？**

- **1.25^severity**（产奶速度/产奶量）：用的是**泌乳严重度 severity**。例：severity=0.5 → 1.25^0.5≈**1.12**（+12%）；severity=1 → **1.25**（+25%）。
- **1.25^max(severity,0.5)**（饥饿）：同样用泌乳严重度，至少按 0.5 档算；与产奶同一倍率。

**你设计的 10%×(1−耐受)**：用的是**耐受**（0～1）。有效% = 10%×(1−耐受)，耐受越高有效%越低；产量、速度、饥饿、持续**都**用这一个数。

**和原来的区别（一句话）**  
- **原**：产奶速度 1.25^severity、饥饿 1.31^max(severity,0.5)、产量 1^severity，三项不一致。  
- **现**：三项统一 **lactatingEfficiencyMultiplierPerStack^severity**（默认 1.25），**无 severity 上限**；每日削减 **-0.1×(1+耐受)**。

---

## 合并公式（可选扩展：耐受参与加成）

当前代码**三项统一倍率、每日削减受耐受**已实现。若将来要让「加成」也受耐受削成 **1+(原倍率−1)×(1−耐受)**，需在 stat 计算处按 pawn 当前耐受再乘 (1−耐受)；GenStage 为预计算表，无法按 pawn 区分耐受，故未实现。

---

## 比方：吃 1 个 / 2 个 / 多个

前提：**三项统一倍率 1.25**；每次 +0.5、**无上限**；耐受每次 +0.044；**每日削减 = -0.1×(1+耐受)**。

|  | 吃 1 个 | 吃 2 个 | 吃 5 个 |
|--|---------|---------|---------|
| severity | 0.5 | 1.0 | 2.5 |
| 耐受 | 0.044 | 0.088 | 0.22 |
| **产奶速度/产奶量/饥饿**（统一） | 约 +12%（1.25^0.5） | 约 +25%（1.25^1） | 约 +75%（1.25^2.5） |
| **每日削减** | -0.104 | -0.109 | -0.122；成瘾且满足需求时 **0** |

**结论**：产奶速度、产奶量、饥饿**同一倍率**，吃越多叠越多（无上限）。**每日削减受耐受影响**；成瘾且定期吃药时不削减。

---

## 比方：连续吃 1～4 颗 — 受严重程度和耐受共同影响

前提：**三项统一倍率 1.25**；每次 severity +0.5、**无上限**（1/2/3/4/5 颗 → 0.5/1/1.5/2/2.5）；耐受每次 +0.044。**恢复时间** = severity ÷ (0.1×(1+耐受))。

|  | 吃 1 颗 | 吃 2 颗 | 吃 3 颗 | 吃 4 颗 | 吃 5 颗 |
|--|---------|---------|---------|---------|---------|
| **severity** | 0.5 | 1.0 | 1.5 | 2.0 | 2.5 |
| **耐受** | 0.044 | 0.088 | 0.132 | 0.176 | 0.22 |
| **产奶速度/产奶量/饥饿**（统一 1.25^severity） | 约 **+12%** | 约 **+25%** | 约 **+40%** | 约 **+56%** | 约 **+75%** |
| **每日削减** | -0.104 | -0.109 | -0.113 | -0.118 | -0.122 |
| **恢复时间**（掉到 0） | 约 **4.8 天** | 约 **9.2 天** | 约 **13.3 天** | 约 **17 天** | 约 **20.5 天** |

说明：三项统一倍率后，同一 severity 下产奶速度/产奶量/饥饿加成%一致。恢复时间 = severity ÷ 每日削减。

---

## 产奶速度 / 产奶量 / 饥饿 — 已统一

**已实现**：代码里三项都用 **lactatingEfficiencyMultiplierPerStack**（默认 1.25），GenStage 中产奶量、产奶效率、饥饿同一倍率，加成%一致。

---

## 代码里产出的奶有多少营养？

**营养不是代码里算出来的，而是奶的 ThingDef 里写的。**

- 挤奶时：`CompEquallyMilkable.Gathered()` 生成 `ThingMaker.MakeThing(ResourceDef)`，数量 = `MilkAmount() × fullness`（单位数）。不设营养值，营养来自该 ThingDef 的 stat。
- 人类奶：`Defs/HumanMilik.xml` 里 **EM_HumanMilk** 的 `statBases` 有 `<Nutrition>0.05</Nutrition>`，所以**每 1 单位人类奶 = 0.05 营养**。  
  其他种族/奶类型看对应奶的 Def；代码里用 `MilkDef().ingestible?.CachedNutrition` 或该 Thing 的 Nutrition stat 读出来的就是 Def 里定义的值。
- 因此：**产出的奶营养 = 单位数 × 该奶 Def 的 Nutrition**。人类默认是每单位 0.05。

---

## 检查：吃 2.5 营养能产多少奶？会不会溢出营养？

**结论**：游戏里**没有**「吃 2.5 营养 → 直接换算成 X 营养奶」的公式。产奶按**时间**算（fullness 随时间涨），摄入的 2.5 营养只进饥饿条，不单独换算成奶。**默认设置下会溢出**：每天多产的奶提供的营养 &gt; 因泌乳多消耗的营养。

**计算要点**：人类 BaseNutritionPerDay≈1.6；泌乳多消耗 ≈ 1.6×(1.25^severity−1)（三项统一后）；每天产奶营养 ≈ 3×1.25^severity/0.25×0.05 = 0.6×1.25^severity。severity=1 时多吃≈0.45、多产≈0.75 → 仍可能溢出。若要不溢出，需调低产奶量/效率或提高倍率，或加规则限制。

**备注（旧设想）**：早期文档里「基础 10%×(1−耐受)」为另一套设计（只看耐受、不看 severity），未实现；当前以「三项统一倍率 + 每日削减受耐受」为准。
